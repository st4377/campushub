==> Cloning from https://github.com/itzsoulbrahs/campushub
==> Checking out commit ecbb99d245cf9746c468c3d852eaaba54ae92f98 in branch main
==> Using Node.js version 22.16.0 (default)
==> Docs on specifying a Node.js version: https://render.com/docs/node-version
==> Running build command 'npm install && npm run build'...
added 457 packages, and audited 458 packages in 11s
43 packages are looking for funding
  run `npm fund` for details
6 vulnerabilities (2 low, 4 moderate)
To address issues that do not require attention, run:
  npm audit fix
To address all issues (including breaking changes), run:
  npm audit fix --force
Run `npm audit` for details.
> rest-express@1.0.0 build
> tsx script/build.ts
building client...
vite v7.1.12 building for production...
transforming...
âœ“ 2284 modules transformed.
rendering chunks...
[meta-images] no Replit deployment domain found, skipping meta tag updates
computing gzip size...
../dist/public/index.html                                                   1.54 kB â”‚ gzip:   0.60 kB
../dist/public/assets/abstract_dark_neon_network_background-CWnB_8H1.png  996.75 kB
../dist/public/assets/index-B1C8t6sm.css                                  146.97 kB â”‚ gzip:  22.27 kB
../dist/public/assets/index-BrHLJE4p.js                                   828.81 kB â”‚ gzip: 242.06 kB
(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 4.75s
building server...
  dist/index.cjs  1.2mb âš ï¸
âš¡ Done in 193ms
==> Uploading build...
==> Uploaded in 6.1s. Compression took 4.1s
==> Build successful ðŸŽ‰
==> Setting WEB_CONCURRENCY=1 by default, based on available CPUs in the instance
==> Deploying...
==> Running 'node dist/index.cjs'
/opt/render/project/src/dist/index.cjs:80
`);c.write(a.format.apply(a,S))}}x(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:x(function(){return o},"get"),set:x(function(R){o=R},"set")}),e.exports.warnTo=function(R){var S=c;return c=R,S},e.exports.getFileName=function(R){var S=R||fe.env,k=S.PGPASSFILE||(o?r.join(S.APPDATA||"./","postgresql","pgpass.conf"):r.join(S.HOME||"./",".pgpass"));return k},e.exports.usePgPass=function(R,S){return Object.prototype.hasOwnProperty.call(fe.env,"PGPASSWORD")?!1:o?!0:(S=S||"<unkn>",g(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',S),!1):!0:(w('WARNING: password file "%s" is not a plain file',S),!1))};var E=e.exports.match=function(R,S){return m.slice(0,-1).reduce(function(k,T,C){return C==1&&Number(R[T]||s)===Number(S[T])?k&&!0:k&&(S[T]==="*"||S[T]===R[T])},!0)};e.exports.getPassword=function(R,S,k){var T,C=S.pipe(i());function q($){var L=_($);L&&P(L)&&E(R,L)&&(T=L[y],C.end())}x(q,"onLine");var B=x(function(){S.destroy(),k(T)},"onEnd"),V=x(function($){S.destroy(),w("WARNING: error on reading file: %s",$),k(void 0)},"onErr");S.on("error",V),C.on("data",q).on("end",B).on("error",V)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var S="",k="",T=0,C=0,q=0,B={},V=!1,$=x(function(F,W,Q){var te=R.substring(W,Q);Object.hasOwnProperty.call(fe.env,"PGPASS_NO_DEESCAPE")||(te=te.replace(/\\([:\\])/g,"$1")),B[m[F]]=te},"addToObj"),L=0;L<R.length-1;L+=1){if(S=R.charAt(L+1),k=R.charAt(L),V=T==f-1,V){$(T,C);break}L>=0&&S==":"&&k!=="\\"&&($(T,C,L+1),C=L+2,T+=1)}return B=Object.keys(B).length===f?B:null,B},P=e.exports.isValidEntry=function(R){for(var S={0:function(B){return B.length>0},1:function(B){return B==="*"?!0:(B=Number(B),isFinite(B)&&B>0&&B<9007199254740992&&Math.floor(B)===B)},2:function(B){return B.length>0},3:function(B){return B.length>0},4:function(B){return B.length>0}},k=0;k<m.length;k+=1){var T=S[k],C=R[m[k]]||"",q=T(C);if(!q)return!1}return!0}}),xR=de((t,e)=>{"use strict";ee();var r=(Y_(),ut(ch)),n=(J_(),ut(uh)),i=bR();e.exports=function(a,s){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return s(void 0);var l=n.createReadStream(o);i.getPassword(a,l,s)})},e.exports.warnTo=i.warnTo}),ph=de((t,e)=>{"use strict";ee();var r=uu();function n(i){this._types=i||r,this.text={},this.binary={}}x(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,a,s){typeof a=="function"&&(s=a,a="text"),this.getOverrides(a)[i]=s},n.prototype.getTypeParser=function(i,a){return a=a||"text",this.getOverrides(a)[i]||this._types.getTypeParser(i,a)},e.exports=n}),iS={};nr(iS,{default:()=>aS});var aS,wR=Lt(()=>{"use strict";ee(),aS={}}),sS={};nr(sS,{parse:()=>fh});function fh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:a,host:s,hostname:o,port:c,pathname:u,search:l,searchParams:p,hash:h}=new URL(n);a=decodeURIComponent(a),i=decodeURIComponent(i),u=decodeURIComponent(u);let g=i+":"+a,m=e?Object.fromEntries(p.entries()):l;return{href:t,protocol:r,auth:g,username:i,password:a,host:s,hostname:o,port:c,pathname:u,search:l,query:m,hash:h}}var oS=Lt(()=>{"use strict";ee(),x(fh,"parse")}),_R=de((t,e)=>{"use strict";ee();var r=(oS(),ut(sS)),n=(J_(),ut(uh));function i(a){if(a.charAt(0)==="/"){var o=a.split(" ");return{host:o[0],database:o[1]}}var s=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(a)?encodeURI(a).replace(/\%25(\d\d)/g,"%$1"):a,!0),o=s.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(s.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=s.port,s.protocol=="socket:")return o.host=decodeURI(s.pathname),o.database=s.query.db,o.client_encoding=s.query.encoding,o;o.host||(o.host=s.hostname);var l=s.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var p=l.split("/");o.host=decodeURIComponent(p[0]),l=p.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}x(i,"parse"),e.exports=i,i.parse=i}),dh=de((t,e)=>{"use strict";ee();var r=(wR(),ut(iS)),n=lu(),i=_R().parse,a=x(function(p,h,g){return g===void 0?g=fe.env["PG"+p.toUpperCase()]:g===!1||(g=fe.env[g]),h[p]||g||n[p]},"val"),s=x(function(){switch(fe.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=x(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=x(function(p,h,g){var m=h[g];m!=null&&p.push(g+"="+o(m))},"add"),u=class{constructor(h){h=typeof h=="string"?i(h):h||{},h.connectionString&&(h=Object.assign({},h,i(h.connectionString))),this.user=a("user",h),this.database=a("database",h),this.database===void 0&&(this.database=this.user),this.port=parseInt(a("port",h),10),this.host=a("host",h),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:a("password",h)}),this.binary=a("binary",h),this.options=a("options",h),this.ssl=typeof h.ssl>"u"?s():h.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=a("client_encoding",h),this.replication=a("replication",h),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=a("application_name",h,"PGAPPNAME"),this.fallback_application_name=a("fallback_application_name",h,!1),this.statement_timeout=a("statement_timeout",h,!1),this.lock_timeout=a("lock_timeout",h,!1),this.idle_in_transaction_session_timeout=a("idle_in_transaction_session_timeout",h,!1),this.query_timeout=a("query_timeout",h,!1),h.connectionTimeoutMillis===void 0?this.connect_timeout=fe.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(h.connectionTimeoutMillis/1e3),h.keepAlive===!1?this.keepalives=0:h.keepAlive===!0&&(this.keepalives=1),typeof h.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(h.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(h){var g=[];c(g,this,"user"),c(g,this,"password"),c(g,this,"port"),c(g,this,"application_name"),c(g,this,"fallback_application_name"),c(g,this,"connect_timeout"),c(g,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(g,m,"sslmode"),c(g,m,"sslca"),c(g,m,"sslkey"),c(g,m,"sslcert"),c(g,m,"sslrootcert"),this.database&&g.push("dbname="+o(this.database)),this.replication&&g.push("replication="+o(this.replication)),this.host&&g.push("host="+o(this.host)),this.isDomainSocket)return h(null,g.join(" "));this.client_encoding&&g.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(f,y){return f?h(f,null):(g.push("hostaddr="+o(y)),h(null,g.join(" ")))})}};x(u,"ConnectionParameters");var l=u;e.exports=l}),SR=de((t,e)=>{"use strict";ee();var r=uu(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var p=o[u];p!==null?c[u]=this._parsers[u](p):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var p=o[u],h=this.fields[u].name;p!==null?c[h]=this._parsers[u](p):c[h]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};x(i,"Result");var a=i;e.exports=a}),ER=de((t,e)=>{"use strict";ee();var{EventEmitter:r}=Xn(),n=SR(),i=pu(),a=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,fe.domain&&c.callback&&(this.callback=fe.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){fe.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};x(a,"Query");var s=a;e.exports=s}),cS={};nr(cS,{Socket:()=>sn,isIP:()=>uS});function uS(t){return 0}var M_,nh,zs,sn,hh=Lt(()=>{"use strict";ee(),M_=ua(Xn(),1),x(uS,"isIP"),nh=/^[^.]+\./,zs=class ne extends M_.EventEmitter{constructor(){super(...arguments),ce(this,"opts",{}),ce(this,"connecting",!1),ce(this,"pending",!0),ce(this,"writable",!0),ce(this,"encrypted",!1),ce(this,"authorized",!1),ce(this,"destroyed",!1),ce(this,"ws",null),ce(this,"writeBuffer"),ce(this,"tlsState",0),ce(this,"tlsRead"),ce(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=x(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),a=x((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=oe.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),s;try{s=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+s;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),a(this.ws);else try{this.ws=new WebSocket(o),a(this.ws)}catch{this.ws=new __unstable_WebSocket(o),a(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+s;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),a(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),a=this.rawWrite.bind(this),[s,o]=await this.subtls.startTls(e,r,i,a,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=s,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=oe.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=oe.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=oe.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},x(zs,"Socket"),ce(zs,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:x((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(nh,"apiauth."):n=t.replace(nh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:x(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ce(zs,"opts",{}),sn=zs}),lS=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(L,F,W){super(L),this.length=F,this.name=W}};x(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(L,F){this.length=L,this.chunk=F,this.name="copyData"}};x(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var a=class{constructor(L,F,W,Q){this.length=L,this.name=F,this.binary=W,this.columnTypes=new Array(Q)}};x(a,"CopyResponse");var s=a;t.CopyResponse=s;var o=class{constructor(L,F,W,Q,te,he,ae){this.name=L,this.tableID=F,this.columnID=W,this.dataTypeID=Q,this.dataTypeSize=te,this.dataTypeModifier=he,this.format=ae}};x(o,"Field");var c=o;t.Field=c;var u=class{constructor(L,F){this.length=L,this.fieldCount=F,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};x(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var p=class{constructor(L,F){this.length=L,this.parameterCount=F,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};x(p,"ParameterDescriptionMessage");var h=p;t.ParameterDescriptionMessage=h;var g=class{constructor(L,F,W){this.length=L,this.parameterName=F,this.parameterValue=W,this.name="parameterStatus"}};x(g,"ParameterStatusMessage");var m=g;t.ParameterStatusMessage=m;var f=class{constructor(L,F){this.length=L,this.salt=F,this.name="authenticationMD5Password"}};x(f,"AuthenticationMD5Password");var y=f;t.AuthenticationMD5Password=y;var w=class{constructor(L,F,W){this.length=L,this.processID=F,this.secretKey=W,this.name="backendKeyData"}};x(w,"BackendKeyDataMessage");var E=w;t.BackendKeyDataMessage=E;var _=class{constructor(L,F,W,Q){this.length=L,this.processId=F,this.channel=W,this.payload=Q,this.name="notification"}};x(_,"NotificationResponseMessage");var P=_;t.NotificationResponseMessage=P;var R=class{constructor(L,F){this.length=L,this.status=F,this.name="readyForQuery"}};x(R,"ReadyForQueryMessage");var S=R;t.ReadyForQueryMessage=S;var k=class{constructor(L,F){this.length=L,this.text=F,this.name="commandComplete"}};x(k,"CommandCompleteMessage");var T=k;t.CommandCompleteMessage=T;var C=class{constructor(L,F){this.length=L,this.fields=F,this.name="dataRow",this.fieldCount=F.length}};x(C,"DataRowMessage");var q=C;t.DataRowMessage=q;var B=class{constructor(L,F){this.length=L,this.message=F,this.name="notice"}};x(B,"NoticeMessage");var V=B;t.NoticeMessage=V}),CR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=oe.allocUnsafe(i)}ensure(i){var a=this.buffer.length-this.offset;if(a<i){var s=this.buffer,o=s.length+(s.length>>1)+i;this.buffer=oe.allocUnsafe(o),s.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var a=oe.byteLength(i);this.ensure(a+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=a}return this.buffer[this.offset++]=0,this}addString(i=""){var a=oe.byteLength(i);return this.ensure(a),this.buffer.write(i,this.offset),this.offset+=a,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let a=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(a,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var a=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=oe.allocUnsafe(this.size),a}};x(e,"Writer");var r=e;t.Writer=r}),kR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=CR(),r=new e.Writer,n=x(L=>{r.addInt16(3).addInt16(0);for(let Q of Object.keys(L))r.addCString(Q).addCString(L[Q]);r.addCString("client_encoding").addCString("UTF8");var F=r.addCString("").flush(),W=F.length+4;return new e.Writer().addInt32(W).add(F).flush()},"startup"),i=x(()=>{let L=oe.allocUnsafe(8);return L.writeInt32BE(8,0),L.writeInt32BE(80877103,4),L},"requestSsl"),a=x(L=>r.addCString(L).flush(112),"password"),s=x(function(L,F){return r.addCString(L).addInt32(oe.byteLength(F)).addString(F),r.flush(112)},"sendSASLInitialResponseMessage"),o=x(function(L){return r.addString(L).flush(112)},"sendSCRAMClientFinalMessage"),c=x(L=>r.addCString(L).flush(81),"query"),u=[],l=x(L=>{let F=L.name||"";F.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",F,F.length),console.error("This can cause conflicts and silent errors executing queries"));let W=L.types||u;for(var Q=W.length,te=r.addCString(F).addCString(L.text).addInt16(Q),he=0;he<Q;he++)te.addInt32(W[he]);return r.flush(80)},"parse"),p=new e.Writer,h=x(function(L,F){for(let W=0;W<L.length;W++){let Q=F?F(L[W],W):L[W];Q==null?(r.addInt16(0),p.addInt32(-1)):Q instanceof oe?(r.addInt16(1),p.addInt32(Q.length),p.add(Q)):(r.addInt16(0),p.addInt32(oe.byteLength(Q)),p.addString(Q))}},"writeValues"),g=x((L={})=>{let F=L.portal||"",W=L.statement||"",Q=L.binary||!1,te=L.values||u,he=te.length;return r.addCString(F).addCString(W),r.addInt16(he),h(te,L.valueMapper),r.addInt16(he),r.add(p.flush()),r.addInt16(Q?1:0),r.flush(66)},"bind"),m=oe.from([69,0,0,0,9,0,0,0,0,0]),f=x(L=>{if(!L||!L.portal&&!L.rows)return m;let F=L.portal||"",W=L.rows||0,Q=oe.byteLength(F),te=4+Q+1+4,he=oe.allocUnsafe(1+te);return he[0]=69,he.writeInt32BE(te,1),he.write(F,5,"utf-8"),he[Q+5]=0,he.writeUInt32BE(W,he.length-4),he},"execute"),y=x((L,F)=>{let W=oe.allocUnsafe(16);return W.writeInt32BE(16,0),W.writeInt16BE(1234,4),W.writeInt16BE(5678,6),W.writeInt32BE(L,8),W.writeInt32BE(F,12),W},"cancel"),w=x((L,F)=>{let W=4+oe.byteLength(F)+1,Q=oe.allocUnsafe(1+W);return Q[0]=L,Q.writeInt32BE(W,1),Q.write(F,5,"utf-8"),Q[W]=0,Q},"cstringMessage"),E=r.addCString("P").flush(68),_=r.addCString("S").flush(68),P=x(L=>L.name?w(68,`${L.type}${L.name||""}`):L.type==="P"?E:_,"describe"),R=x(L=>{let F=`${L.type}${L.name||""}`;return w(67,F)},"close"),S=x(L=>r.add(L).flush(100),"copyData"),k=x(L=>w(102,L),"copyFail"),T=x(L=>oe.from([L,0,0,0,4]),"codeOnlyBuffer"),C=T(72),q=T(83),B=T(88),V=T(99),$={startup:n,password:a,requestSsl:i,sendSASLInitialResponseMessage:s,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:g,execute:f,describe:P,close:R,flush:x(()=>C,"flush"),sync:x(()=>q,"sync"),end:x(()=>B,"end"),copyData:S,copyDone:x(()=>V,"copyDone"),copyFail:k,cancel:y};t.serialize=$}),TR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=oe.allocUnsafe(0),r=class{constructor(a=0){this.offset=a,this.buffer=e,this.encoding="utf-8"}setBuffer(a,s){this.offset=a,this.buffer=s}int16(){let a=this.buffer.readInt16BE(this.offset);return this.offset+=2,a}byte(){let a=this.buffer[this.offset];return this.offset++,a}int32(){let a=this.buffer.readInt32BE(this.offset);return this.offset+=4,a}string(a){let s=this.buffer.toString(this.encoding,this.offset,this.offset+a);return this.offset+=a,s}cstring(){let a=this.offset,s=a;for(;this.buffer[s++]!==0;);return this.offset=s,this.buffer.toString(this.encoding,a,s-1)}bytes(a){let s=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a,s}};x(r,"BufferReader");var n=r;t.BufferReader=n}),AR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=lS(),r=TR(),n=1,i=4,a=n+i,s=oe.allocUnsafe(0),o=class{constructor(l){if(this.buffer=s,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,p){this.mergeBuffer(l);let h=this.bufferOffset+this.bufferLength,g=this.bufferOffset;for(;g+a<=h;){let m=this.buffer[g],f=this.buffer.readUInt32BE(g+n),y=n+f;if(y+g<=h){let w=this.handlePacket(g+a,m,f,this.buffer);p(w),g+=y}else break}g===h?(this.buffer=s,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=h-g,this.bufferOffset=g)}mergeBuffer(l){if(this.bufferLength>0){let p=this.bufferLength+l.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let h;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)h=this.buffer;else{let g=this.buffer.byteLength*2;for(;p>=g;)g*=2;h=oe.allocUnsafe(g)}this.buffer.copy(h,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=h,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,p,h,g){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,h,g);case 67:return this.parseCommandCompleteMessage(l,h,g);case 90:return this.parseReadyForQueryMessage(l,h,g);case 65:return this.parseNotificationMessage(l,h,g);case 82:return this.parseAuthenticationResponse(l,h,g);case 83:return this.parseParameterStatusMessage(l,h,g);case 75:return this.parseBackendKeyData(l,h,g);case 69:return this.parseErrorMessage(l,h,g,"error");case 78:return this.parseErrorMessage(l,h,g,"notice");case 84:return this.parseRowDescriptionMessage(l,h,g);case 116:return this.parseParameterDescriptionMessage(l,h,g);case 71:return this.parseCopyInMessage(l,h,g);case 72:return this.parseCopyOutMessage(l,h,g);case 100:return this.parseCopyData(l,h,g);default:return new e.DatabaseError("received invalid response: "+p.toString(16),h,"error")}}parseReadyForQueryMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.string(1);return new e.ReadyForQueryMessage(p,g)}parseCommandCompleteMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.cstring();return new e.CommandCompleteMessage(p,g)}parseCopyData(l,p,h){let g=h.slice(l,l+(p-4));return new e.CopyDataMessage(p,g)}parseCopyInMessage(l,p,h){return this.parseCopyMessage(l,p,h,"copyInResponse")}parseCopyOutMessage(l,p,h){return this.parseCopyMessage(l,p,h,"copyOutResponse")}parseCopyMessage(l,p,h,g){this.reader.setBuffer(l,h);let m=this.reader.byte()!==0,f=this.reader.int16(),y=new e.CopyResponse(p,g,m,f);for(let w=0;w<f;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int32(),m=this.reader.cstring(),f=this.reader.cstring();return new e.NotificationResponseMessage(p,g,m,f)}parseRowDescriptionMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int16(),m=new e.RowDescriptionMessage(p,g);for(let f=0;f<g;f++)m.fields[f]=this.parseField();return m}parseField(){let l=this.reader.cstring(),p=this.reader.int32(),h=this.reader.int16(),g=this.reader.int32(),m=this.reader.int16(),f=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,p,h,g,m,f,y)}parseParameterDescriptionMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int16(),m=new e.ParameterDescriptionMessage(p,g);for(let f=0;f<g;f++)m.dataTypeIDs[f]=this.reader.int32();return m}parseDataRowMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int16(),m=new Array(g);for(let f=0;f<g;f++){let y=this.reader.int32();m[f]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(p,m)}parseParameterStatusMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(p,g,m)}parseBackendKeyData(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(p,g,m)}parseAuthenticationResponse(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int32(),m={name:"authenticationOk",length:p};switch(g){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let f;do f=this.reader.cstring(),f&&m.mechanisms.push(f);while(f);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(p-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+g)}return m}parseErrorMessage(l,p,h,g){this.reader.setBuffer(l,h);let m={},f=this.reader.string(1);for(;f!=="\0";)m[f]=this.reader.cstring(),f=this.reader.string(1);let y=m.M,w=g==="notice"?new e.NoticeMessage(p,y):new e.DatabaseError(y,p,g);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};x(o,"Parser");var c=o;t.Parser=c}),pS=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=lS();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:x(function(){return e.DatabaseError},"get")});var r=kR();Object.defineProperty(t,"serialize",{enumerable:!0,get:x(function(){return r.serialize},"get")});var n=AR();function i(a,s){let o=new n.Parser;return a.on("data",c=>o.parse(c,s)),new Promise(c=>a.on("end",()=>c()))}x(i,"parse"),t.parse=i}),fS={};nr(fS,{connect:()=>dS});function dS({socket:t,servername:e}){return t.startTls(e),t}var PR=Lt(()=>{"use strict";ee(),x(dS,"connect")}),hS=de((t,e)=>{"use strict";ee();var r=(hh(),ut(cS)),n=Xn().EventEmitter,{parse:i,serialize:a}=pS(),s=a.flush(),o=a.sync(),c=a.end(),u=class extends n{constructor(h){super(),h=h||{},this.stream=h.stream||new r.Socket,this._keepAlive=h.keepAlive,this._keepAliveInitialDelayMillis=h.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=h.ssl||!1,this._ending=!1,this._emitMessage=!1;var g=this;this.on("newListener",function(m){m==="message"&&(g._emitMessage=!0)})}connect(h,g){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(h,g),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let f=x(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",f),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var E=(PR(),ut(fS));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(g)===0&&(_.servername=g);try{m.stream=E.connect(_)}catch(P){return m.emit("error",P)}m.attachListeners(m.stream),m.stream.on("error",f),m.emit("sslconnect")})}attachListeners(h){h.on("end",()=>{this.emit("end")}),i(h,g=>{var m=g.name==="error"?"errorMessage":g.name;this._emitMessage&&this.emit("message",g),this.emit(m,g)})}requestSsl(){this.stream.write(a.requestSsl())}startup(h){this.stream.write(a.startup(h))}cancel(h,g){this._send(a.cancel(h,g))}password(h){this._send(a.password(h))}sendSASLInitialResponseMessage(h,g){this._send(a.sendSASLInitialResponseMessage(h,g))}sendSCRAMClientFinalMessage(h){this._send(a.sendSCRAMClientFinalMessage(h))}_send(h){return this.stream.writable?this.stream.write(h):!1}query(h){this._send(a.query(h))}parse(h){this._send(a.parse(h))}bind(h){this._send(a.bind(h))}execute(h){this._send(a.execute(h))}flush(){this.stream.writable&&this.stream.write(s)}sync(){this._ending=!0,this._send(s),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(h){this._send(a.close(h))}describe(h){this._send(a.describe(h))}sendCopyFromChunk(h){this._send(a.copyData(h))}endCopyFrom(){this._send(a.copyDone())}sendCopyFail(h){this._send(a.copyFail(h))}};x(u,"Connection");var l=u;e.exports=l}),IR=de((t,e)=>{"use strict";ee();var r=Xn().EventEmitter,n=(cu(),ut(Vs)),i=pu(),a=gR(),s=xR(),o=ph(),c=dh(),u=ER(),l=lu(),p=hS(),h=class extends r{constructor(f){super(),this.connectionParameters=new c(f),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=f||{};this._Promise=y.Promise||ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new p({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(f){let y=x(w=>{fe.nextTick(()=>{w.handleError(f,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(f){var y=this,w=this.connection;if(this._connectionCallback=f,this._connecting||this._connected){let E=new Error("Client has already been connected. You cannot reuse a client.");fe.nextTick(()=>{f(E)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let E=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(E),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(E):this._handleErrorEvent(E):this._connectionError||this._handleErrorEvent(E)),fe.nextTick(()=>{this.emit("end")})})}connect(f){if(f){this._connect(f);return}return new this._Promise((y,w)=>{this._connect(E=>{E?w(E):y()})})}_attachListeners(f){f.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),f.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),f.on("authenticationSASL",this._handleAuthSASL.bind(this)),f.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),f.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),f.on("backendKeyData",this._handleBackendKeyData.bind(this)),f.on("error",this._handleErrorEvent.bind(this)),f.on("errorMessage",this._handleErrorMessage.bind(this)),f.on("readyForQuery",this._handleReadyForQuery.bind(this)),f.on("notice",this._handleNotice.bind(this)),f.on("rowDescription",this._handleRowDescription.bind(this)),f.on("dataRow",this._handleDataRow.bind(this)),f.on("portalSuspended",this._handlePortalSuspended.bind(this)),f.on("emptyQuery",this._handleEmptyQuery.bind(this)),f.on("commandComplete",this._handleCommandComplete.bind(this)),f.on("parseComplete",this._handleParseComplete.bind(this)),f.on("copyInResponse",this._handleCopyInResponse.bind(this)),f.on("copyData",this._handleCopyData.bind(this)),f.on("notification",this._handleNotification.bind(this))}_checkPgPass(f){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;f()}).catch(w=>{y.emit("error",w)}):this.password!==null?f():s(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),f()})}_handleAuthCleartextPassword(f){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(f){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,f.salt);this.connection.password(y)})}_handleAuthSASL(f){this._checkPgPass(()=>{this.saslSession=a.startSession(f.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(f){a.continueSession(this.saslSession,this.password,f.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(f){a.finalizeSession(this.saslSession,f.data),this.saslSession=null}_handleBackendKeyData(f){this.processID=f.processID,this.secretKey=f.secretKey}_handleReadyForQuery(f){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(f){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(f);this.emit("error",f)}}_handleErrorEvent(f){if(this._connecting)return this._handleErrorWhileConnecting(f);this._queryable=!1,this._errorAllQueries(f),this.emit("error",f)}_handleErrorMessage(f){if(this._connecting)return this._handleErrorWhileConnecting(f);let y=this.activeQuery;if(!y){this._handleErrorEvent(f);return}this.activeQuery=null,y.handleError(f,this.connection)}_handleRowDescription(f){this.activeQuery.handleRowDescription(f)}_handleDataRow(f){this.activeQuery.handleDataRow(f)}_handlePortalSuspended(f){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(f){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(f){this.activeQuery.handleCommandComplete(f,this.connection)}_handleParseComplete(f){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(f){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(f){this.activeQuery.handleCopyData(f,this.connection)}_handleNotification(f){this.emit("notification",f)}_handleNotice(f){this.emit("notice",f)}getStartupConf(){var f=this.connectionParameters,y={user:f.user,database:f.database},w=f.application_name||f.fallback_application_name;return w&&(y.application_name=w),f.replication&&(y.replication=""+f.replication),f.statement_timeout&&(y.statement_timeout=String(parseInt(f.statement_timeout,10))),f.lock_timeout&&(y.lock_timeout=String(parseInt(f.lock_timeout,10))),f.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(f.idle_in_transaction_session_timeout,10))),f.options&&(y.options=f.options),y}cancel(f,y){if(f.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(f.processID,f.secretKey)})}else f.queryQueue.indexOf(y)!==-1&&f.queryQueue.splice(f.queryQueue.indexOf(y),1)}setTypeParser(f,y,w){return this._types.setTypeParser(f,y,w)}getTypeParser(f,y){return this._types.getTypeParser(f,y)}escapeIdentifier(f){return'"'+f.replace(/"/g,'""')+'"'}escapeLiteral(f){for(var y=!1,w="'",E=0;E<f.length;E++){var _=f[E];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let f=this.activeQuery.submit(this.connection);f&&fe.nextTick(()=>{this.activeQuery.handleError(f,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(f,y,w){var E,_,P,R,S;if(f==null)throw new TypeError("Client was passed a null or undefined query");return typeof f.submit=="function"?(P=f.query_timeout||this.connectionParameters.query_timeout,_=E=f,typeof y=="function"&&(E.callback=E.callback||y)):(P=this.connectionParameters.query_timeout,E=new u(f,y,w),E.callback||(_=new this._Promise((k,T)=>{E.callback=(C,q)=>C?T(C):k(q)}))),P&&(S=E.callback,R=setTimeout(()=>{var k=new Error("Query read timeout");fe.nextTick(()=>{E.handleError(k,this.connection)}),S(k),E.callback=()=>{};var T=this.queryQueue.indexOf(E);T>-1&&this.queryQueue.splice(T,1),this._pulseQueryQueue()},P),E.callback=(k,T)=>{clearTimeout(R),S(k,T)}),this.binary&&!E.binary&&(E.binary=!0),E._result&&!E._result._types&&(E._result._types=this._types),this._queryable?this._ending?(fe.nextTick(()=>{E.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(E),this._pulseQueryQueue(),_):(fe.nextTick(()=>{E.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(f){if(this._ending=!0,!this.connection._connecting)if(f)f();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),f)this.connection.once("end",f);else return new this._Promise(y=>{this.connection.once("end",y)})}};x(h,"Client");var g=h;g.Query=u,e.exports=g}),OR=de((t,e)=>{"use strict";ee();var r=Xn().EventEmitter,n=x(function(){},"NOOP"),i=x((m,f)=>{let y=m.findIndex(f);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),a=class{constructor(f,y,w){this.client=f,this.idleListener=y,this.timeoutId=w}};x(a,"IdleItem");var s=a,o=class{constructor(f){this.callback=f}};x(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}x(u,"throwOnDoubleRelease");function l(m,f){if(f)return{callback:f,result:void 0};let y,w,E=x(function(P,R){P?y(P):w(R)},"cb"),_=new m(function(P,R){w=P,y=R}).catch(P=>{throw Error.captureStackTrace(P),P});return{callback:E,result:_}}x(l,"promisify");function p(m,f){return x(function y(w){w.client=f,f.removeListener("error",y),f.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(f),m.emit("error",w,f)},"idleListener")}x(p,"makeIdleListener");var h=class extends r{constructor(f,y){super(),this.options=Object.assign({},f),f!=null&&"password"in f&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),f!=null&&f.ssl&&f.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||mh().Client,this.Promise=this.options.Promise||ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let f=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let E=y.idleListener;return this._acquireClient(w,f,E,!1)}if(!this._isFull())return this.newClient(f);throw new Error("unexpected condition")}_remove(f){let y=i(this._idle,w=>w.client===f);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==f),f.end(),this.emit("remove",f)}connect(f){if(this.ending){let E=new Error("Cannot use a pool after calling end on the pool");return f?f(E):this.Promise.reject(E)}let y=l(this.Promise,f),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&fe.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let E=x((R,S,k)=>{clearTimeout(P),y.callback(R,S,k)},"queueCallback"),_=new c(E),P=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===E),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(f){let y=new this.Client(this.options);this._clients.push(y);let w=p(this,y);this.log("checking client timeout");let E,_=!1;this.options.connectionTimeoutMillis&&(E=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(P=>{if(E&&clearTimeout(E),y.on("error",w),P)this.log("client failed to connect",P),this._clients=this._clients.filter(R=>R!==y),_&&(P.message="Connection terminated due to connection timeout"),this._pulseQueue(),f.timedOut||f.callback(P,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(S=>S.client===y)!==-1&&this._acquireClient(y,new c((S,k,T)=>T()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,f,w,!0)}})}_acquireClient(f,y,w,E){E&&this.emit("connect",f),this.emit("acquire",f),f.release=this._releaseOnce(f,w),f.removeListener("error",w),y.timedOut?E&&this.options.verify?this.options.verify(f,f.release):f.release():E&&this.options.verify?this.options.verify(f,_=>{if(_)return f.release(_),y.callback(_,void 0,n);y.callback(void 0,f,f.release)}):y.callback(void 0,f,f.release)}_releaseOnce(f,y){let w=!1;return E=>{w&&u(),w=!0,this._release(f,y,E)}}_release(f,y,w){if(f.on("error",y),f._poolUseCount=(f._poolUseCount||0)+1,this.emit("release",w,f),w||this.ending||!f._queryable||f._ending||f._poolUseCount>=this.options.maxUses){f._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(f),this._pulseQueue();return}if(this._expired.has(f)){this.log("remove expired client"),this._expired.delete(f),this._remove(f),this._pulseQueue();return}let E;this.options.idleTimeoutMillis&&(E=setTimeout(()=>{this.log("remove idle client"),this._remove(f)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&E.unref()),this.options.allowExitOnIdle&&f.unref(),this._idle.push(new s(f,y,E)),this._pulseQueue()}query(f,y,w){if(typeof f=="function"){let _=l(this.Promise,f);return sh(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let E=l(this.Promise,w);return w=E.callback,this.connect((_,P)=>{if(_)return w(_);let R=!1,S=x(k=>{R||(R=!0,P.release(k),w(k))},"onError");P.once("error",S),this.log("dispatching query");try{P.query(f,y,(k,T)=>{if(this.log("query dispatched"),P.removeListener("error",S),!R)return R=!0,P.release(k),k?w(k):w(void 0,T)})}catch(k){return P.release(k),w(k)}}),E.result}end(f){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return f?f(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,f);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((f,y)=>f+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};x(h,"Pool");var g=h;e.exports=g}),mS={};nr(mS,{default:()=>gS});var gS,NR=Lt(()=>{"use strict";ee(),gS={}}),RR=de((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),jR=de((t,e)=>{"use strict";ee();var r=Xn().EventEmitter,n=(cu(),ut(Vs)),i=pu(),a=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(a,r);var s={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};a.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=s[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},a.prototype.then=function(o,c){return this._getPromise().then(o,c)},a.prototype.catch=function(o){return this._getPromise().catch(o)},a.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},a.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=x(function(h,g,m){if(o.native.arrayMode=!1,sh(function(){c.emit("_done")}),h)return c.handleError(h);c._emitRowEvents&&(m.length>1?g.forEach((f,y)=>{f.forEach(w=>{c.emit("row",w,m[y])})}):g.forEach(function(f){c.emit("row",f,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(fe.domain&&(u=fe.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let h=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(h)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(h){return h?u(h):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let h=new Error("Query values must be an array");return u(h)}var p=this.values.map(i.prepareValue);o.native.query(this.text,p,u)}else o.native.query(this.text,u)}}),LR=de((t,e)=>{"use strict";ee();var r=(NR(),ut(mS)),n=ph(),i=RR(),a=Xn().EventEmitter,s=(cu(),ut(Vs)),o=dh(),c=jR(),u=e.exports=function(l){a.call(this),l=l||{},this._Promise=l.Promise||ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new o(l);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};u.Query=c,s.inherits(u,a),u.prototype._errorAllQueries=function(l){let p=x(h=>{fe.nextTick(()=>{h.native=this.native,h.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},u.prototype._connect=function(l){var p=this;if(this._connecting){fe.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(h,g){if(h)return l(h);p.native.connect(g,function(m){if(m)return p.native.end(),l(m);p._connected=!0,p.native.on("error",function(f){p._queryable=!1,p._errorAllQueries(f),p.emit("error",f)}),p.native.on("notification",function(f){p.emit("notification",{channel:f.relname,payload:f.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((p,h)=>{this._connect(g=>{g?h(g):p()})})},u.prototype.query=function(l,p,h){var g,m,f,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")f=l.query_timeout||this.connectionParameters.query_timeout,m=g=l,typeof p=="function"&&(l.callback=p);else if(f=this.connectionParameters.query_timeout,g=new c(l,p,h),!g.callback){let E,_;m=new this._Promise((P,R)=>{E=P,_=R}),g.callback=(P,R)=>P?_(P):E(R)}return f&&(w=g.callback,y=setTimeout(()=>{var E=new Error("Query read timeout");fe.nextTick(()=>{g.handleError(E,this.connection)}),w(E),g.callback=()=>{};var _=this._queryQueue.indexOf(g);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},f),g.callback=(E,_)=>{clearTimeout(y),w(E,_)}),this._queryable?this._ending?(g.native=this.native,fe.nextTick(()=>{g.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(g),this._pulseQueryQueue(),m):(g.native=this.native,fe.nextTick(()=>{g.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var h;return l||(h=new this._Promise(function(g,m){l=x(f=>f?m(f):g(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),fe.nextTick(()=>{p.emit("end"),l&&l()})}),h},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){l||this.emit("drain");return}this._activeQuery=p,p.submit(this);var h=this;p.once("_done",function(){h._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,p,h){return this._types.setTypeParser(l,p,h)},u.prototype.getTypeParser=function(l,p){return this._types.getTypeParser(l,p)}}),D_=de((t,e)=>{"use strict";ee(),e.exports=LR()}),mh=de((t,e)=>{"use strict";ee();var r=IR(),n=lu(),i=hS(),a=OR(),{DatabaseError:s}=pS(),o=x(u=>{var l;return l=class extends a{constructor(p){super(p,u)}},x(l,"BoundPool"),l},"poolFactory"),c=x(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=uu(),this.DatabaseError=s},"PG");typeof fe.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(D_()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(D_())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var vS=ua(mh());hh();ee();hh();oS();var qR=ua(pu()),BR=ua(ph());function yS(t){return t instanceof oe?"\\x"+t.toString("hex"):t}x(yS,"encodeBuffersAsBytea");var bS=class xS extends Error{constructor(e){super(e),ce(this,"name","NeonDbError"),ce(this,"severity"),ce(this,"code"),ce(this,"detail"),ce(this,"hint"),ce(this,"position"),ce(this,"internalPosition"),ce(this,"internalQuery"),ce(this,"where"),ce(this,"schema"),ce(this,"table"),ce(this,"column"),ce(this,"dataType"),ce(this,"constraint"),ce(this,"file"),ce(this,"line"),ce(this,"routine"),ce(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,xS)}};x(bS,"NeonDbError");var oa=bS,F_="transaction() expects an array of queries, or a function returning an array of queries",MR=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function wS(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:a,deferrable:s,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=fh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:h,hostname:g,port:m,pathname:f}=l;if(p!=="postgres:"&&p!=="postgresql:"||!h||!g||!f)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(E,..._){let P,R;if(typeof E=="string")P=E,R=_[1],_=_[0]??[];else{P="";for(let k=0;k<E.length;k++)P+=E[k],k<_.length&&(P+="$"+(k+1))}_=_.map(k=>yS((0,qR.prepareValue)(k)));let S={query:P,params:_};return o&&o(S),_S(w,S,R)}x(y,"resolve"),y.transaction=async(E,_)=>{if(typeof E=="function"&&(E=E(y)),!Array.isArray(E))throw new Error(F_);E.forEach(S=>{if(S[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(F_)});let P=E.map(S=>S.parameterizedQuery),R=E.map(S=>S.opts??{});return w(P,R,_)};async function w(E,_,P){let{fetchEndpoint:R,fetchFunction:S}=sn,k=Array.isArray(E)?{queries:E}:E,T=n??{},C=e??!1,q=r??!1,B=i,V=a,$=s;P!==void 0&&(P.fetchOptions!==void 0&&(T={...T,...P.fetchOptions}),P.arrayMode!==void 0&&(C=P.arrayMode),P.fullResults!==void 0&&(q=P.fullResults),P.isolationLevel!==void 0&&(B=P.isolationLevel),P.readOnly!==void 0&&(V=P.readOnly),P.deferrable!==void 0&&($=P.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(T={...T,..._.fetchOptions});let L=u;!Array.isArray(_)&&_?.authToken!==void 0&&(L=_.authToken);let F=typeof R=="function"?R(g,m,{jwtAuth:L!==void 0}):R,W={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},Q=await SS(L);Q&&(W.Authorization=`Bearer ${Q}`),Array.isArray(E)&&(B!==void 0&&(W["Neon-Batch-Isolation-Level"]=B),V!==void 0&&(W["Neon-Batch-Read-Only"]=String(V)),$!==void 0&&(W["Neon-Batch-Deferrable"]=String($)));let te;try{te=await(S??fetch)(F,{method:"POST",body:JSON.stringify(k),headers:W,...T})}catch(he){let ae=new oa(`Error connecting to database: ${he.message}`);throw ae.sourceError=he,ae}if(te.ok){let he=await te.json();if(Array.isArray(E)){let ae=he.results;if(!Array.isArray(ae))throw new oa("Neon internal error: unexpected result format");return ae.map((xe,$e)=>{let mn=_[$e]??{},Ea=mn.arrayMode??C,Ca=mn.fullResults??q;return ah(xe,{arrayMode:Ea,fullResults:Ca,parameterizedQuery:E[$e],resultCallback:c,types:mn.types})})}else{let ae=_??{},xe=ae.arrayMode??C,$e=ae.fullResults??q;return ah(he,{arrayMode:xe,fullResults:$e,parameterizedQuery:E,resultCallback:c,types:ae.types})}}else{let{status:he}=te;if(he===400){let ae=await te.json(),xe=new oa(ae.message);for(let $e of MR)xe[$e]=ae[$e]??void 0;throw xe}else{let ae=await te.text();throw new oa(`Server error (HTTP status ${he}): ${ae}`)}}}return x(w,"execute"),y}x(wS,"neon");function _S(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:x((n,i)=>t(e,r).then(n,i),"then"),catch:x(n=>t(e,r).catch(n),"catch"),finally:x(n=>t(e,r).finally(n),"finally")}}x(_S,"createNeonQueryPromise");function ah(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:a}){let s=new BR.default(a),o=t.fields.map(l=>l.name),c=t.fields.map(l=>s.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((p,h)=>p===null?null:c[h](p))):t.rows.map(l=>Object.fromEntries(l.map((p,h)=>[o[h],p===null?null:c[h](p)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=s,t):u}x(ah,"processQueryResult");async function SS(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new oa("Error getting auth token.");throw e instanceof Error&&(r=new oa(`Error getting auth token: ${e.message}`)),r}}x(SS,"getAuthToken");var DR=ua(dh()),la=ua(mh()),ES=class extends vS.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=this.connec
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
==> Running 'node dist/index.cjs'
/opt/render/project/src/dist/index.cjs:80
`);c.write(a.format.apply(a,S))}}x(w,"warn"),Object.defineProperty(e.exports,"isWin",{get:x(function(){return o},"get"),set:x(function(R){o=R},"set")}),e.exports.warnTo=function(R){var S=c;return c=R,S},e.exports.getFileName=function(R){var S=R||fe.env,k=S.PGPASSFILE||(o?r.join(S.APPDATA||"./","postgresql","pgpass.conf"):r.join(S.HOME||"./",".pgpass"));return k},e.exports.usePgPass=function(R,S){return Object.prototype.hasOwnProperty.call(fe.env,"PGPASSWORD")?!1:o?!0:(S=S||"<unkn>",g(R.mode)?R.mode&(u|l)?(w('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',S),!1):!0:(w('WARNING: password file "%s" is not a plain file',S),!1))};var E=e.exports.match=function(R,S){return m.slice(0,-1).reduce(function(k,T,C){return C==1&&Number(R[T]||s)===Number(S[T])?k&&!0:k&&(S[T]==="*"||S[T]===R[T])},!0)};e.exports.getPassword=function(R,S,k){var T,C=S.pipe(i());function q($){var L=_($);L&&P(L)&&E(R,L)&&(T=L[y],C.end())}x(q,"onLine");var B=x(function(){S.destroy(),k(T)},"onEnd"),V=x(function($){S.destroy(),w("WARNING: error on reading file: %s",$),k(void 0)},"onErr");S.on("error",V),C.on("data",q).on("end",B).on("error",V)};var _=e.exports.parseLine=function(R){if(R.length<11||R.match(/^\s+#/))return null;for(var S="",k="",T=0,C=0,q=0,B={},V=!1,$=x(function(F,W,Q){var te=R.substring(W,Q);Object.hasOwnProperty.call(fe.env,"PGPASS_NO_DEESCAPE")||(te=te.replace(/\\([:\\])/g,"$1")),B[m[F]]=te},"addToObj"),L=0;L<R.length-1;L+=1){if(S=R.charAt(L+1),k=R.charAt(L),V=T==f-1,V){$(T,C);break}L>=0&&S==":"&&k!=="\\"&&($(T,C,L+1),C=L+2,T+=1)}return B=Object.keys(B).length===f?B:null,B},P=e.exports.isValidEntry=function(R){for(var S={0:function(B){return B.length>0},1:function(B){return B==="*"?!0:(B=Number(B),isFinite(B)&&B>0&&B<9007199254740992&&Math.floor(B)===B)},2:function(B){return B.length>0},3:function(B){return B.length>0},4:function(B){return B.length>0}},k=0;k<m.length;k+=1){var T=S[k],C=R[m[k]]||"",q=T(C);if(!q)return!1}return!0}}),xR=de((t,e)=>{"use strict";ee();var r=(Y_(),ut(ch)),n=(J_(),ut(uh)),i=bR();e.exports=function(a,s){var o=i.getFileName();n.stat(o,function(c,u){if(c||!i.usePgPass(u,o))return s(void 0);var l=n.createReadStream(o);i.getPassword(a,l,s)})},e.exports.warnTo=i.warnTo}),ph=de((t,e)=>{"use strict";ee();var r=uu();function n(i){this._types=i||r,this.text={},this.binary={}}x(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,a,s){typeof a=="function"&&(s=a,a="text"),this.getOverrides(a)[i]=s},n.prototype.getTypeParser=function(i,a){return a=a||"text",this.getOverrides(a)[i]||this._types.getTypeParser(i,a)},e.exports=n}),iS={};nr(iS,{default:()=>aS});var aS,wR=Lt(()=>{"use strict";ee(),aS={}}),sS={};nr(sS,{parse:()=>fh});function fh(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:a,host:s,hostname:o,port:c,pathname:u,search:l,searchParams:p,hash:h}=new URL(n);a=decodeURIComponent(a),i=decodeURIComponent(i),u=decodeURIComponent(u);let g=i+":"+a,m=e?Object.fromEntries(p.entries()):l;return{href:t,protocol:r,auth:g,username:i,password:a,host:s,hostname:o,port:c,pathname:u,search:l,query:m,hash:h}}var oS=Lt(()=>{"use strict";ee(),x(fh,"parse")}),_R=de((t,e)=>{"use strict";ee();var r=(oS(),ut(sS)),n=(J_(),ut(uh));function i(a){if(a.charAt(0)==="/"){var o=a.split(" ");return{host:o[0],database:o[1]}}var s=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(a)?encodeURI(a).replace(/\%25(\d\d)/g,"%$1"):a,!0),o=s.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var u=(s.auth||":").split(":");if(o.user=u[0],o.password=u.splice(1).join(":"),o.port=s.port,s.protocol=="socket:")return o.host=decodeURI(s.pathname),o.database=s.query.db,o.client_encoding=s.query.encoding,o;o.host||(o.host=s.hostname);var l=s.pathname;if(!o.host&&l&&/^%2f/i.test(l)){var p=l.split("/");o.host=decodeURIComponent(p[0]),l=p.splice(1).join("/")}switch(l&&l.charAt(0)==="/"&&(l=l.slice(1)||null),o.database=l&&decodeURI(l),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}x(i,"parse"),e.exports=i,i.parse=i}),dh=de((t,e)=>{"use strict";ee();var r=(wR(),ut(iS)),n=lu(),i=_R().parse,a=x(function(p,h,g){return g===void 0?g=fe.env["PG"+p.toUpperCase()]:g===!1||(g=fe.env[g]),h[p]||g||n[p]},"val"),s=x(function(){switch(fe.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=x(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=x(function(p,h,g){var m=h[g];m!=null&&p.push(g+"="+o(m))},"add"),u=class{constructor(h){h=typeof h=="string"?i(h):h||{},h.connectionString&&(h=Object.assign({},h,i(h.connectionString))),this.user=a("user",h),this.database=a("database",h),this.database===void 0&&(this.database=this.user),this.port=parseInt(a("port",h),10),this.host=a("host",h),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:a("password",h)}),this.binary=a("binary",h),this.options=a("options",h),this.ssl=typeof h.ssl>"u"?s():h.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=a("client_encoding",h),this.replication=a("replication",h),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=a("application_name",h,"PGAPPNAME"),this.fallback_application_name=a("fallback_application_name",h,!1),this.statement_timeout=a("statement_timeout",h,!1),this.lock_timeout=a("lock_timeout",h,!1),this.idle_in_transaction_session_timeout=a("idle_in_transaction_session_timeout",h,!1),this.query_timeout=a("query_timeout",h,!1),h.connectionTimeoutMillis===void 0?this.connect_timeout=fe.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(h.connectionTimeoutMillis/1e3),h.keepAlive===!1?this.keepalives=0:h.keepAlive===!0&&(this.keepalives=1),typeof h.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(h.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(h){var g=[];c(g,this,"user"),c(g,this,"password"),c(g,this,"port"),c(g,this,"application_name"),c(g,this,"fallback_application_name"),c(g,this,"connect_timeout"),c(g,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(g,m,"sslmode"),c(g,m,"sslca"),c(g,m,"sslkey"),c(g,m,"sslcert"),c(g,m,"sslrootcert"),this.database&&g.push("dbname="+o(this.database)),this.replication&&g.push("replication="+o(this.replication)),this.host&&g.push("host="+o(this.host)),this.isDomainSocket)return h(null,g.join(" "));this.client_encoding&&g.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(f,y){return f?h(f,null):(g.push("hostaddr="+o(y)),h(null,g.join(" ")))})}};x(u,"ConnectionParameters");var l=u;e.exports=l}),SR=de((t,e)=>{"use strict";ee();var r=uu(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),u=0,l=o.length;u<l;u++){var p=o[u];p!==null?c[u]=this._parsers[u](p):c[u]=null}return c}parseRow(o){for(var c={},u=0,l=o.length;u<l;u++){var p=o[u],h=this.fields[u].name;p!==null?c[h]=this._parsers[u](p):c[h]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var u=o[c];this._types?this._parsers[c]=this._types.getTypeParser(u.dataTypeID,u.format||"text"):this._parsers[c]=r.getTypeParser(u.dataTypeID,u.format||"text")}}};x(i,"Result");var a=i;e.exports=a}),ER=de((t,e)=>{"use strict";ee();var{EventEmitter:r}=Xn(),n=SR(),i=pu(),a=class extends r{constructor(c,u,l){super(),c=i.normalizeQueryConfig(c,u,l),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,fe.domain&&c.callback&&(this.callback=fe.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let u;if(!this._canceledDueToError){try{u=this._result.parseRow(c.fields)}catch(l){this._canceledDueToError=l;return}this.emit("row",u,this._result),this._accumulateRows&&this._result.addRow(u)}}handleCommandComplete(c,u){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&u.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,u){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(u){fe.nextTick(()=>{throw u})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let u=c.parsedStatements[this.name];return this.text&&u&&this.text!==u?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,u){c.execute({portal:this.portal,rows:u}),u?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(u){this.handleError(u,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,u){}};x(a,"Query");var s=a;e.exports=s}),cS={};nr(cS,{Socket:()=>sn,isIP:()=>uS});function uS(t){return 0}var M_,nh,zs,sn,hh=Lt(()=>{"use strict";ee(),M_=ua(Xn(),1),x(uS,"isIP"),nh=/^[^.]+\./,zs=class ne extends M_.EventEmitter{constructor(){super(...arguments),ce(this,"opts",{}),ce(this,"connecting",!1),ce(this,"pending",!0),ce(this,"writable",!0),ce(this,"encrypted",!1),ce(this,"authorized",!1),ce(this,"destroyed",!1),ce(this,"ws",null),ce(this,"writeBuffer"),ce(this,"tlsState",0),ce(this,"tlsRead"),ce(this,"tlsWrite")}static get poolQueryViaFetch(){return ne.opts.poolQueryViaFetch??ne.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){ne.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return ne.opts.fetchEndpoint??ne.defaults.fetchEndpoint}static set fetchEndpoint(e){ne.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return ne.opts.fetchFunction??ne.defaults.fetchFunction}static set fetchFunction(e){ne.opts.fetchFunction=e}static get webSocketConstructor(){return ne.opts.webSocketConstructor??ne.defaults.webSocketConstructor}static set webSocketConstructor(e){ne.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??ne.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return ne.opts.wsProxy??ne.defaults.wsProxy}static set wsProxy(e){ne.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??ne.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return ne.opts.coalesceWrites??ne.defaults.coalesceWrites}static set coalesceWrites(e){ne.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??ne.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return ne.opts.useSecureWebSocket??ne.defaults.useSecureWebSocket}static set useSecureWebSocket(e){ne.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??ne.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return ne.opts.forceDisablePgSSL??ne.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){ne.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??ne.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return ne.opts.disableSNI??ne.defaults.disableSNI}static set disableSNI(e){ne.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??ne.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return ne.opts.pipelineConnect??ne.defaults.pipelineConnect}static set pipelineConnect(e){ne.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??ne.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return ne.opts.subtls??ne.defaults.subtls}static set subtls(e){ne.opts.subtls=e}get subtls(){return this.opts.subtls??ne.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return ne.opts.pipelineTLS??ne.defaults.pipelineTLS}static set pipelineTLS(e){ne.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??ne.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return ne.opts.rootCerts??ne.defaults.rootCerts}static set rootCerts(e){ne.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??ne.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=x(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),a=x((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",u=>{this.emit("error",u),this.emit("close")}),o.addEventListener("message",u=>{if(this.tlsState===0){let l=oe.from(u.data);this.emit("data",l)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),s;try{s=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+s;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),a(this.ws);else try{this.ws=new WebSocket(o),a(this.ws)}catch{this.ws=new __unstable_WebSocket(o),a(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+s;fetch(c,{headers:{Upgrade:"websocket"}}).then(u=>{if(this.ws=u.webSocket,this.ws==null)throw o;this.ws.accept(),a(this.ws,!0)}).catch(u=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${u.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),a=this.rawWrite.bind(this),[s,o]=await this.subtls.startTls(e,r,i,a,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=s,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=oe.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=oe.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=oe.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},x(zs,"Socket"),ce(zs,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:x((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(nh,"apiauth."):n=t.replace(nh,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:x(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),ce(zs,"opts",{}),sn=zs}),lS=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(L,F,W){super(L),this.length=F,this.name=W}};x(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(L,F){this.length=L,this.chunk=F,this.name="copyData"}};x(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var a=class{constructor(L,F,W,Q){this.length=L,this.name=F,this.binary=W,this.columnTypes=new Array(Q)}};x(a,"CopyResponse");var s=a;t.CopyResponse=s;var o=class{constructor(L,F,W,Q,te,he,ae){this.name=L,this.tableID=F,this.columnID=W,this.dataTypeID=Q,this.dataTypeSize=te,this.dataTypeModifier=he,this.format=ae}};x(o,"Field");var c=o;t.Field=c;var u=class{constructor(L,F){this.length=L,this.fieldCount=F,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};x(u,"RowDescriptionMessage");var l=u;t.RowDescriptionMessage=l;var p=class{constructor(L,F){this.length=L,this.parameterCount=F,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};x(p,"ParameterDescriptionMessage");var h=p;t.ParameterDescriptionMessage=h;var g=class{constructor(L,F,W){this.length=L,this.parameterName=F,this.parameterValue=W,this.name="parameterStatus"}};x(g,"ParameterStatusMessage");var m=g;t.ParameterStatusMessage=m;var f=class{constructor(L,F){this.length=L,this.salt=F,this.name="authenticationMD5Password"}};x(f,"AuthenticationMD5Password");var y=f;t.AuthenticationMD5Password=y;var w=class{constructor(L,F,W){this.length=L,this.processID=F,this.secretKey=W,this.name="backendKeyData"}};x(w,"BackendKeyDataMessage");var E=w;t.BackendKeyDataMessage=E;var _=class{constructor(L,F,W,Q){this.length=L,this.processId=F,this.channel=W,this.payload=Q,this.name="notification"}};x(_,"NotificationResponseMessage");var P=_;t.NotificationResponseMessage=P;var R=class{constructor(L,F){this.length=L,this.status=F,this.name="readyForQuery"}};x(R,"ReadyForQueryMessage");var S=R;t.ReadyForQueryMessage=S;var k=class{constructor(L,F){this.length=L,this.text=F,this.name="commandComplete"}};x(k,"CommandCompleteMessage");var T=k;t.CommandCompleteMessage=T;var C=class{constructor(L,F){this.length=L,this.fields=F,this.name="dataRow",this.fieldCount=F.length}};x(C,"DataRowMessage");var q=C;t.DataRowMessage=q;var B=class{constructor(L,F){this.length=L,this.message=F,this.name="notice"}};x(B,"NoticeMessage");var V=B;t.NoticeMessage=V}),CR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=oe.allocUnsafe(i)}ensure(i){var a=this.buffer.length-this.offset;if(a<i){var s=this.buffer,o=s.length+(s.length>>1)+i;this.buffer=oe.allocUnsafe(o),s.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var a=oe.byteLength(i);this.ensure(a+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=a}return this.buffer[this.offset++]=0,this}addString(i=""){var a=oe.byteLength(i);return this.ensure(a),this.buffer.write(i,this.offset),this.offset+=a,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let a=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(a,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var a=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=oe.allocUnsafe(this.size),a}};x(e,"Writer");var r=e;t.Writer=r}),kR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=CR(),r=new e.Writer,n=x(L=>{r.addInt16(3).addInt16(0);for(let Q of Object.keys(L))r.addCString(Q).addCString(L[Q]);r.addCString("client_encoding").addCString("UTF8");var F=r.addCString("").flush(),W=F.length+4;return new e.Writer().addInt32(W).add(F).flush()},"startup"),i=x(()=>{let L=oe.allocUnsafe(8);return L.writeInt32BE(8,0),L.writeInt32BE(80877103,4),L},"requestSsl"),a=x(L=>r.addCString(L).flush(112),"password"),s=x(function(L,F){return r.addCString(L).addInt32(oe.byteLength(F)).addString(F),r.flush(112)},"sendSASLInitialResponseMessage"),o=x(function(L){return r.addString(L).flush(112)},"sendSCRAMClientFinalMessage"),c=x(L=>r.addCString(L).flush(81),"query"),u=[],l=x(L=>{let F=L.name||"";F.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",F,F.length),console.error("This can cause conflicts and silent errors executing queries"));let W=L.types||u;for(var Q=W.length,te=r.addCString(F).addCString(L.text).addInt16(Q),he=0;he<Q;he++)te.addInt32(W[he]);return r.flush(80)},"parse"),p=new e.Writer,h=x(function(L,F){for(let W=0;W<L.length;W++){let Q=F?F(L[W],W):L[W];Q==null?(r.addInt16(0),p.addInt32(-1)):Q instanceof oe?(r.addInt16(1),p.addInt32(Q.length),p.add(Q)):(r.addInt16(0),p.addInt32(oe.byteLength(Q)),p.addString(Q))}},"writeValues"),g=x((L={})=>{let F=L.portal||"",W=L.statement||"",Q=L.binary||!1,te=L.values||u,he=te.length;return r.addCString(F).addCString(W),r.addInt16(he),h(te,L.valueMapper),r.addInt16(he),r.add(p.flush()),r.addInt16(Q?1:0),r.flush(66)},"bind"),m=oe.from([69,0,0,0,9,0,0,0,0,0]),f=x(L=>{if(!L||!L.portal&&!L.rows)return m;let F=L.portal||"",W=L.rows||0,Q=oe.byteLength(F),te=4+Q+1+4,he=oe.allocUnsafe(1+te);return he[0]=69,he.writeInt32BE(te,1),he.write(F,5,"utf-8"),he[Q+5]=0,he.writeUInt32BE(W,he.length-4),he},"execute"),y=x((L,F)=>{let W=oe.allocUnsafe(16);return W.writeInt32BE(16,0),W.writeInt16BE(1234,4),W.writeInt16BE(5678,6),W.writeInt32BE(L,8),W.writeInt32BE(F,12),W},"cancel"),w=x((L,F)=>{let W=4+oe.byteLength(F)+1,Q=oe.allocUnsafe(1+W);return Q[0]=L,Q.writeInt32BE(W,1),Q.write(F,5,"utf-8"),Q[W]=0,Q},"cstringMessage"),E=r.addCString("P").flush(68),_=r.addCString("S").flush(68),P=x(L=>L.name?w(68,`${L.type}${L.name||""}`):L.type==="P"?E:_,"describe"),R=x(L=>{let F=`${L.type}${L.name||""}`;return w(67,F)},"close"),S=x(L=>r.add(L).flush(100),"copyData"),k=x(L=>w(102,L),"copyFail"),T=x(L=>oe.from([L,0,0,0,4]),"codeOnlyBuffer"),C=T(72),q=T(83),B=T(88),V=T(99),$={startup:n,password:a,requestSsl:i,sendSASLInitialResponseMessage:s,sendSCRAMClientFinalMessage:o,query:c,parse:l,bind:g,execute:f,describe:P,close:R,flush:x(()=>C,"flush"),sync:x(()=>q,"sync"),end:x(()=>B,"end"),copyData:S,copyDone:x(()=>V,"copyDone"),copyFail:k,cancel:y};t.serialize=$}),TR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=oe.allocUnsafe(0),r=class{constructor(a=0){this.offset=a,this.buffer=e,this.encoding="utf-8"}setBuffer(a,s){this.offset=a,this.buffer=s}int16(){let a=this.buffer.readInt16BE(this.offset);return this.offset+=2,a}byte(){let a=this.buffer[this.offset];return this.offset++,a}int32(){let a=this.buffer.readInt32BE(this.offset);return this.offset+=4,a}string(a){let s=this.buffer.toString(this.encoding,this.offset,this.offset+a);return this.offset+=a,s}cstring(){let a=this.offset,s=a;for(;this.buffer[s++]!==0;);return this.offset=s,this.buffer.toString(this.encoding,a,s-1)}bytes(a){let s=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a,s}};x(r,"BufferReader");var n=r;t.BufferReader=n}),AR=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=lS(),r=TR(),n=1,i=4,a=n+i,s=oe.allocUnsafe(0),o=class{constructor(l){if(this.buffer=s,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,l?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=l?.mode||"text"}parse(l,p){this.mergeBuffer(l);let h=this.bufferOffset+this.bufferLength,g=this.bufferOffset;for(;g+a<=h;){let m=this.buffer[g],f=this.buffer.readUInt32BE(g+n),y=n+f;if(y+g<=h){let w=this.handlePacket(g+a,m,f,this.buffer);p(w),g+=y}else break}g===h?(this.buffer=s,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=h-g,this.bufferOffset=g)}mergeBuffer(l){if(this.bufferLength>0){let p=this.bufferLength+l.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let h;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)h=this.buffer;else{let g=this.buffer.byteLength*2;for(;p>=g;)g*=2;h=oe.allocUnsafe(g)}this.buffer.copy(h,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=h,this.bufferOffset=0}l.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=l,this.bufferOffset=0,this.bufferLength=l.byteLength}handlePacket(l,p,h,g){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(l,h,g);case 67:return this.parseCommandCompleteMessage(l,h,g);case 90:return this.parseReadyForQueryMessage(l,h,g);case 65:return this.parseNotificationMessage(l,h,g);case 82:return this.parseAuthenticationResponse(l,h,g);case 83:return this.parseParameterStatusMessage(l,h,g);case 75:return this.parseBackendKeyData(l,h,g);case 69:return this.parseErrorMessage(l,h,g,"error");case 78:return this.parseErrorMessage(l,h,g,"notice");case 84:return this.parseRowDescriptionMessage(l,h,g);case 116:return this.parseParameterDescriptionMessage(l,h,g);case 71:return this.parseCopyInMessage(l,h,g);case 72:return this.parseCopyOutMessage(l,h,g);case 100:return this.parseCopyData(l,h,g);default:return new e.DatabaseError("received invalid response: "+p.toString(16),h,"error")}}parseReadyForQueryMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.string(1);return new e.ReadyForQueryMessage(p,g)}parseCommandCompleteMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.cstring();return new e.CommandCompleteMessage(p,g)}parseCopyData(l,p,h){let g=h.slice(l,l+(p-4));return new e.CopyDataMessage(p,g)}parseCopyInMessage(l,p,h){return this.parseCopyMessage(l,p,h,"copyInResponse")}parseCopyOutMessage(l,p,h){return this.parseCopyMessage(l,p,h,"copyOutResponse")}parseCopyMessage(l,p,h,g){this.reader.setBuffer(l,h);let m=this.reader.byte()!==0,f=this.reader.int16(),y=new e.CopyResponse(p,g,m,f);for(let w=0;w<f;w++)y.columnTypes[w]=this.reader.int16();return y}parseNotificationMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int32(),m=this.reader.cstring(),f=this.reader.cstring();return new e.NotificationResponseMessage(p,g,m,f)}parseRowDescriptionMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int16(),m=new e.RowDescriptionMessage(p,g);for(let f=0;f<g;f++)m.fields[f]=this.parseField();return m}parseField(){let l=this.reader.cstring(),p=this.reader.int32(),h=this.reader.int16(),g=this.reader.int32(),m=this.reader.int16(),f=this.reader.int32(),y=this.reader.int16()===0?"text":"binary";return new e.Field(l,p,h,g,m,f,y)}parseParameterDescriptionMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int16(),m=new e.ParameterDescriptionMessage(p,g);for(let f=0;f<g;f++)m.dataTypeIDs[f]=this.reader.int32();return m}parseDataRowMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int16(),m=new Array(g);for(let f=0;f<g;f++){let y=this.reader.int32();m[f]=y===-1?null:this.reader.string(y)}return new e.DataRowMessage(p,m)}parseParameterStatusMessage(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(p,g,m)}parseBackendKeyData(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(p,g,m)}parseAuthenticationResponse(l,p,h){this.reader.setBuffer(l,h);let g=this.reader.int32(),m={name:"authenticationOk",length:p};switch(g){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let y=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,y)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let f;do f=this.reader.cstring(),f&&m.mechanisms.push(f);while(f);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(p-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+g)}return m}parseErrorMessage(l,p,h,g){this.reader.setBuffer(l,h);let m={},f=this.reader.string(1);for(;f!=="\0";)m[f]=this.reader.cstring(),f=this.reader.string(1);let y=m.M,w=g==="notice"?new e.NoticeMessage(p,y):new e.DatabaseError(y,p,g);return w.severity=m.S,w.code=m.C,w.detail=m.D,w.hint=m.H,w.position=m.P,w.internalPosition=m.p,w.internalQuery=m.q,w.where=m.W,w.schema=m.s,w.table=m.t,w.column=m.c,w.dataType=m.d,w.constraint=m.n,w.file=m.F,w.line=m.L,w.routine=m.R,w}};x(o,"Parser");var c=o;t.Parser=c}),pS=de(t=>{"use strict";ee(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=lS();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:x(function(){return e.DatabaseError},"get")});var r=kR();Object.defineProperty(t,"serialize",{enumerable:!0,get:x(function(){return r.serialize},"get")});var n=AR();function i(a,s){let o=new n.Parser;return a.on("data",c=>o.parse(c,s)),new Promise(c=>a.on("end",()=>c()))}x(i,"parse"),t.parse=i}),fS={};nr(fS,{connect:()=>dS});function dS({socket:t,servername:e}){return t.startTls(e),t}var PR=Lt(()=>{"use strict";ee(),x(dS,"connect")}),hS=de((t,e)=>{"use strict";ee();var r=(hh(),ut(cS)),n=Xn().EventEmitter,{parse:i,serialize:a}=pS(),s=a.flush(),o=a.sync(),c=a.end(),u=class extends n{constructor(h){super(),h=h||{},this.stream=h.stream||new r.Socket,this._keepAlive=h.keepAlive,this._keepAliveInitialDelayMillis=h.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=h.ssl||!1,this._ending=!1,this._emitMessage=!1;var g=this;this.on("newListener",function(m){m==="message"&&(g._emitMessage=!0)})}connect(h,g){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(h,g),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let f=x(function(y){m._ending&&(y.code==="ECONNRESET"||y.code==="EPIPE")||m.emit("error",y)},"reportStreamError");if(this.stream.on("error",f),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(y){var w=y.toString("utf8");switch(w){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var E=(PR(),ut(fS));let _={socket:m.stream};m.ssl!==!0&&(Object.assign(_,m.ssl),"key"in m.ssl&&(_.key=m.ssl.key)),r.isIP(g)===0&&(_.servername=g);try{m.stream=E.connect(_)}catch(P){return m.emit("error",P)}m.attachListeners(m.stream),m.stream.on("error",f),m.emit("sslconnect")})}attachListeners(h){h.on("end",()=>{this.emit("end")}),i(h,g=>{var m=g.name==="error"?"errorMessage":g.name;this._emitMessage&&this.emit("message",g),this.emit(m,g)})}requestSsl(){this.stream.write(a.requestSsl())}startup(h){this.stream.write(a.startup(h))}cancel(h,g){this._send(a.cancel(h,g))}password(h){this._send(a.password(h))}sendSASLInitialResponseMessage(h,g){this._send(a.sendSASLInitialResponseMessage(h,g))}sendSCRAMClientFinalMessage(h){this._send(a.sendSCRAMClientFinalMessage(h))}_send(h){return this.stream.writable?this.stream.write(h):!1}query(h){this._send(a.query(h))}parse(h){this._send(a.parse(h))}bind(h){this._send(a.bind(h))}execute(h){this._send(a.execute(h))}flush(){this.stream.writable&&this.stream.write(s)}sync(){this._ending=!0,this._send(s),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(h){this._send(a.close(h))}describe(h){this._send(a.describe(h))}sendCopyFromChunk(h){this._send(a.copyData(h))}endCopyFrom(){this._send(a.copyDone())}sendCopyFail(h){this._send(a.copyFail(h))}};x(u,"Connection");var l=u;e.exports=l}),IR=de((t,e)=>{"use strict";ee();var r=Xn().EventEmitter,n=(cu(),ut(Vs)),i=pu(),a=gR(),s=xR(),o=ph(),c=dh(),u=ER(),l=lu(),p=hS(),h=class extends r{constructor(f){super(),this.connectionParameters=new c(f),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var y=f||{};this._Promise=y.Promise||ou.Promise,this._types=new o(y.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=y.connection||new p({stream:y.stream,ssl:this.connectionParameters.ssl,keepAlive:y.keepAlive||!1,keepAliveInitialDelayMillis:y.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=y.binary||l.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=y.connectionTimeoutMillis||0}_errorAllQueries(f){let y=x(w=>{fe.nextTick(()=>{w.handleError(f,this.connection)})},"enqueueError");this.activeQuery&&(y(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(y),this.queryQueue.length=0}_connect(f){var y=this,w=this.connection;if(this._connectionCallback=f,this._connecting||this._connected){let E=new Error("Client has already been connected. You cannot reuse a client.");fe.nextTick(()=>{f(E)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{w._ending=!0,w.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){y.ssl?w.requestSsl():w.startup(y.getStartupConf())}),w.on("sslconnect",function(){w.startup(y.getStartupConf())}),this._attachListeners(w),w.once("end",()=>{let E=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(E),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(E):this._handleErrorEvent(E):this._connectionError||this._handleErrorEvent(E)),fe.nextTick(()=>{this.emit("end")})})}connect(f){if(f){this._connect(f);return}return new this._Promise((y,w)=>{this._connect(E=>{E?w(E):y()})})}_attachListeners(f){f.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),f.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),f.on("authenticationSASL",this._handleAuthSASL.bind(this)),f.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),f.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),f.on("backendKeyData",this._handleBackendKeyData.bind(this)),f.on("error",this._handleErrorEvent.bind(this)),f.on("errorMessage",this._handleErrorMessage.bind(this)),f.on("readyForQuery",this._handleReadyForQuery.bind(this)),f.on("notice",this._handleNotice.bind(this)),f.on("rowDescription",this._handleRowDescription.bind(this)),f.on("dataRow",this._handleDataRow.bind(this)),f.on("portalSuspended",this._handlePortalSuspended.bind(this)),f.on("emptyQuery",this._handleEmptyQuery.bind(this)),f.on("commandComplete",this._handleCommandComplete.bind(this)),f.on("parseComplete",this._handleParseComplete.bind(this)),f.on("copyInResponse",this._handleCopyInResponse.bind(this)),f.on("copyData",this._handleCopyData.bind(this)),f.on("notification",this._handleNotification.bind(this))}_checkPgPass(f){let y=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(w=>{if(w!==void 0){if(typeof w!="string"){y.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=w}else this.connectionParameters.password=this.password=null;f()}).catch(w=>{y.emit("error",w)}):this.password!==null?f():s(this.connectionParameters,w=>{w!==void 0&&(this.connectionParameters.password=this.password=w),f()})}_handleAuthCleartextPassword(f){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(f){this._checkPgPass(()=>{let y=i.postgresMd5PasswordHash(this.user,this.password,f.salt);this.connection.password(y)})}_handleAuthSASL(f){this._checkPgPass(()=>{this.saslSession=a.startSession(f.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(f){a.continueSession(this.saslSession,this.password,f.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(f){a.finalizeSession(this.saslSession,f.data),this.saslSession=null}_handleBackendKeyData(f){this.processID=f.processID,this.secretKey=f.secretKey}_handleReadyForQuery(f){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:y}=this;this.activeQuery=null,this.readyForQuery=!0,y&&y.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(f){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(f);this.emit("error",f)}}_handleErrorEvent(f){if(this._connecting)return this._handleErrorWhileConnecting(f);this._queryable=!1,this._errorAllQueries(f),this.emit("error",f)}_handleErrorMessage(f){if(this._connecting)return this._handleErrorWhileConnecting(f);let y=this.activeQuery;if(!y){this._handleErrorEvent(f);return}this.activeQuery=null,y.handleError(f,this.connection)}_handleRowDescription(f){this.activeQuery.handleRowDescription(f)}_handleDataRow(f){this.activeQuery.handleDataRow(f)}_handlePortalSuspended(f){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(f){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(f){this.activeQuery.handleCommandComplete(f,this.connection)}_handleParseComplete(f){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(f){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(f){this.activeQuery.handleCopyData(f,this.connection)}_handleNotification(f){this.emit("notification",f)}_handleNotice(f){this.emit("notice",f)}getStartupConf(){var f=this.connectionParameters,y={user:f.user,database:f.database},w=f.application_name||f.fallback_application_name;return w&&(y.application_name=w),f.replication&&(y.replication=""+f.replication),f.statement_timeout&&(y.statement_timeout=String(parseInt(f.statement_timeout,10))),f.lock_timeout&&(y.lock_timeout=String(parseInt(f.lock_timeout,10))),f.idle_in_transaction_session_timeout&&(y.idle_in_transaction_session_timeout=String(parseInt(f.idle_in_transaction_session_timeout,10))),f.options&&(y.options=f.options),y}cancel(f,y){if(f.activeQuery===y){var w=this.connection;this.host&&this.host.indexOf("/")===0?w.connect(this.host+"/.s.PGSQL."+this.port):w.connect(this.port,this.host),w.on("connect",function(){w.cancel(f.processID,f.secretKey)})}else f.queryQueue.indexOf(y)!==-1&&f.queryQueue.splice(f.queryQueue.indexOf(y),1)}setTypeParser(f,y,w){return this._types.setTypeParser(f,y,w)}getTypeParser(f,y){return this._types.getTypeParser(f,y)}escapeIdentifier(f){return'"'+f.replace(/"/g,'""')+'"'}escapeLiteral(f){for(var y=!1,w="'",E=0;E<f.length;E++){var _=f[E];_==="'"?w+=_+_:_==="\\"?(w+=_+_,y=!0):w+=_}return w+="'",y===!0&&(w=" E"+w),w}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let f=this.activeQuery.submit(this.connection);f&&fe.nextTick(()=>{this.activeQuery.handleError(f,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(f,y,w){var E,_,P,R,S;if(f==null)throw new TypeError("Client was passed a null or undefined query");return typeof f.submit=="function"?(P=f.query_timeout||this.connectionParameters.query_timeout,_=E=f,typeof y=="function"&&(E.callback=E.callback||y)):(P=this.connectionParameters.query_timeout,E=new u(f,y,w),E.callback||(_=new this._Promise((k,T)=>{E.callback=(C,q)=>C?T(C):k(q)}))),P&&(S=E.callback,R=setTimeout(()=>{var k=new Error("Query read timeout");fe.nextTick(()=>{E.handleError(k,this.connection)}),S(k),E.callback=()=>{};var T=this.queryQueue.indexOf(E);T>-1&&this.queryQueue.splice(T,1),this._pulseQueryQueue()},P),E.callback=(k,T)=>{clearTimeout(R),S(k,T)}),this.binary&&!E.binary&&(E.binary=!0),E._result&&!E._result._types&&(E._result._types=this._types),this._queryable?this._ending?(fe.nextTick(()=>{E.handleError(new Error("Client was closed and is not queryable"),this.connection)}),_):(this.queryQueue.push(E),this._pulseQueryQueue(),_):(fe.nextTick(()=>{E.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),_)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(f){if(this._ending=!0,!this.connection._connecting)if(f)f();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),f)this.connection.once("end",f);else return new this._Promise(y=>{this.connection.once("end",y)})}};x(h,"Client");var g=h;g.Query=u,e.exports=g}),OR=de((t,e)=>{"use strict";ee();var r=Xn().EventEmitter,n=x(function(){},"NOOP"),i=x((m,f)=>{let y=m.findIndex(f);return y===-1?void 0:m.splice(y,1)[0]},"removeWhere"),a=class{constructor(f,y,w){this.client=f,this.idleListener=y,this.timeoutId=w}};x(a,"IdleItem");var s=a,o=class{constructor(f){this.callback=f}};x(o,"PendingItem");var c=o;function u(){throw new Error("Release called on client which has already been released to the pool.")}x(u,"throwOnDoubleRelease");function l(m,f){if(f)return{callback:f,result:void 0};let y,w,E=x(function(P,R){P?y(P):w(R)},"cb"),_=new m(function(P,R){w=P,y=R}).catch(P=>{throw Error.captureStackTrace(P),P});return{callback:E,result:_}}x(l,"promisify");function p(m,f){return x(function y(w){w.client=f,f.removeListener("error",y),f.on("error",()=>{m.log("additional client error after disconnection due to error",w)}),m._remove(f),m.emit("error",w,f)},"idleListener")}x(p,"makeIdleListener");var h=class extends r{constructor(f,y){super(),this.options=Object.assign({},f),f!=null&&"password"in f&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),f!=null&&f.ssl&&f.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||y||mh().Client,this.Promise=this.options.Promise||ou.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(y=>{this._remove(y.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let f=this._pendingQueue.shift();if(this._idle.length){let y=this._idle.pop();clearTimeout(y.timeoutId);let w=y.client;w.ref&&w.ref();let E=y.idleListener;return this._acquireClient(w,f,E,!1)}if(!this._isFull())return this.newClient(f);throw new Error("unexpected condition")}_remove(f){let y=i(this._idle,w=>w.client===f);y!==void 0&&clearTimeout(y.timeoutId),this._clients=this._clients.filter(w=>w!==f),f.end(),this.emit("remove",f)}connect(f){if(this.ending){let E=new Error("Cannot use a pool after calling end on the pool");return f?f(E):this.Promise.reject(E)}let y=l(this.Promise,f),w=y.result;if(this._isFull()||this._idle.length){if(this._idle.length&&fe.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(y.callback)),w;let E=x((R,S,k)=>{clearTimeout(P),y.callback(R,S,k)},"queueCallback"),_=new c(E),P=setTimeout(()=>{i(this._pendingQueue,R=>R.callback===E),_.timedOut=!0,y.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(_),w}return this.newClient(new c(y.callback)),w}newClient(f){let y=new this.Client(this.options);this._clients.push(y);let w=p(this,y);this.log("checking client timeout");let E,_=!1;this.options.connectionTimeoutMillis&&(E=setTimeout(()=>{this.log("ending client due to timeout"),_=!0,y.connection?y.connection.stream.destroy():y.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),y.connect(P=>{if(E&&clearTimeout(E),y.on("error",w),P)this.log("client failed to connect",P),this._clients=this._clients.filter(R=>R!==y),_&&(P.message="Connection terminated due to connection timeout"),this._pulseQueue(),f.timedOut||f.callback(P,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let R=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(y),this._idle.findIndex(S=>S.client===y)!==-1&&this._acquireClient(y,new c((S,k,T)=>T()),w,!1)},this.options.maxLifetimeSeconds*1e3);R.unref(),y.once("end",()=>clearTimeout(R))}return this._acquireClient(y,f,w,!0)}})}_acquireClient(f,y,w,E){E&&this.emit("connect",f),this.emit("acquire",f),f.release=this._releaseOnce(f,w),f.removeListener("error",w),y.timedOut?E&&this.options.verify?this.options.verify(f,f.release):f.release():E&&this.options.verify?this.options.verify(f,_=>{if(_)return f.release(_),y.callback(_,void 0,n);y.callback(void 0,f,f.release)}):y.callback(void 0,f,f.release)}_releaseOnce(f,y){let w=!1;return E=>{w&&u(),w=!0,this._release(f,y,E)}}_release(f,y,w){if(f.on("error",y),f._poolUseCount=(f._poolUseCount||0)+1,this.emit("release",w,f),w||this.ending||!f._queryable||f._ending||f._poolUseCount>=this.options.maxUses){f._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(f),this._pulseQueue();return}if(this._expired.has(f)){this.log("remove expired client"),this._expired.delete(f),this._remove(f),this._pulseQueue();return}let E;this.options.idleTimeoutMillis&&(E=setTimeout(()=>{this.log("remove idle client"),this._remove(f)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&E.unref()),this.options.allowExitOnIdle&&f.unref(),this._idle.push(new s(f,y,E)),this._pulseQueue()}query(f,y,w){if(typeof f=="function"){let _=l(this.Promise,f);return sh(function(){return _.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),_.result}typeof y=="function"&&(w=y,y=void 0);let E=l(this.Promise,w);return w=E.callback,this.connect((_,P)=>{if(_)return w(_);let R=!1,S=x(k=>{R||(R=!0,P.release(k),w(k))},"onError");P.once("error",S),this.log("dispatching query");try{P.query(f,y,(k,T)=>{if(this.log("query dispatched"),P.removeListener("error",S),!R)return R=!0,P.release(k),k?w(k):w(void 0,T)})}catch(k){return P.release(k),w(k)}}),E.result}end(f){if(this.log("ending"),this.ending){let w=new Error("Called end on pool more than once");return f?f(w):this.Promise.reject(w)}this.ending=!0;let y=l(this.Promise,f);return this._endCallback=y.callback,this._pulseQueue(),y.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((f,y)=>f+(this._expired.has(y)?1:0),0)}get totalCount(){return this._clients.length}};x(h,"Pool");var g=h;e.exports=g}),mS={};nr(mS,{default:()=>gS});var gS,NR=Lt(()=>{"use strict";ee(),gS={}}),RR=de((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),jR=de((t,e)=>{"use strict";ee();var r=Xn().EventEmitter,n=(cu(),ut(Vs)),i=pu(),a=e.exports=function(o,c,u){r.call(this),o=i.normalizeQueryConfig(o,c,u),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(l){l==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(a,r);var s={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};a.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var u in c){var l=s[u]||u;o[l]=c[u]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},a.prototype.then=function(o,c){return this._getPromise().then(o,c)},a.prototype.catch=function(o){return this._getPromise().catch(o)},a.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},a.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var u=x(function(h,g,m){if(o.native.arrayMode=!1,sh(function(){c.emit("_done")}),h)return c.handleError(h);c._emitRowEvents&&(m.length>1?g.forEach((f,y)=>{f.forEach(w=>{c.emit("row",w,m[y])})}):g.forEach(function(f){c.emit("row",f,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(fe.domain&&(u=fe.domain.bind(u)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var l=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let h=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return u(h)}return o.native.execute(this.name,l,u)}return o.native.prepare(this.name,this.text,l.length,function(h){return h?u(h):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,l,u))})}else if(this.values){if(!Array.isArray(this.values)){let h=new Error("Query values must be an array");return u(h)}var p=this.values.map(i.prepareValue);o.native.query(this.text,p,u)}else o.native.query(this.text,u)}}),LR=de((t,e)=>{"use strict";ee();var r=(NR(),ut(mS)),n=ph(),i=RR(),a=Xn().EventEmitter,s=(cu(),ut(Vs)),o=dh(),c=jR(),u=e.exports=function(l){a.call(this),l=l||{},this._Promise=l.Promise||ou.Promise,this._types=new n(l.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new o(l);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};u.Query=c,s.inherits(u,a),u.prototype._errorAllQueries=function(l){let p=x(h=>{fe.nextTick(()=>{h.native=this.native,h.handleError(l)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},u.prototype._connect=function(l){var p=this;if(this._connecting){fe.nextTick(()=>l(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(h,g){if(h)return l(h);p.native.connect(g,function(m){if(m)return p.native.end(),l(m);p._connected=!0,p.native.on("error",function(f){p._queryable=!1,p._errorAllQueries(f),p.emit("error",f)}),p.native.on("notification",function(f){p.emit("notification",{channel:f.relname,payload:f.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),l()})})},u.prototype.connect=function(l){if(l){this._connect(l);return}return new this._Promise((p,h)=>{this._connect(g=>{g?h(g):p()})})},u.prototype.query=function(l,p,h){var g,m,f,y,w;if(l==null)throw new TypeError("Client was passed a null or undefined query");if(typeof l.submit=="function")f=l.query_timeout||this.connectionParameters.query_timeout,m=g=l,typeof p=="function"&&(l.callback=p);else if(f=this.connectionParameters.query_timeout,g=new c(l,p,h),!g.callback){let E,_;m=new this._Promise((P,R)=>{E=P,_=R}),g.callback=(P,R)=>P?_(P):E(R)}return f&&(w=g.callback,y=setTimeout(()=>{var E=new Error("Query read timeout");fe.nextTick(()=>{g.handleError(E,this.connection)}),w(E),g.callback=()=>{};var _=this._queryQueue.indexOf(g);_>-1&&this._queryQueue.splice(_,1),this._pulseQueryQueue()},f),g.callback=(E,_)=>{clearTimeout(y),w(E,_)}),this._queryable?this._ending?(g.native=this.native,fe.nextTick(()=>{g.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(g),this._pulseQueryQueue(),m):(g.native=this.native,fe.nextTick(()=>{g.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},u.prototype.end=function(l){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,l));var h;return l||(h=new this._Promise(function(g,m){l=x(f=>f?m(f):g(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),fe.nextTick(()=>{p.emit("end"),l&&l()})}),h},u.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},u.prototype._pulseQueryQueue=function(l){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){l||this.emit("drain");return}this._activeQuery=p,p.submit(this);var h=this;p.once("_done",function(){h._pulseQueryQueue()})}},u.prototype.cancel=function(l){this._activeQuery===l?this.native.cancel(function(){}):this._queryQueue.indexOf(l)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(l),1)},u.prototype.ref=function(){},u.prototype.unref=function(){},u.prototype.setTypeParser=function(l,p,h){return this._types.setTypeParser(l,p,h)},u.prototype.getTypeParser=function(l,p){return this._types.getTypeParser(l,p)}}),D_=de((t,e)=>{"use strict";ee(),e.exports=LR()}),mh=de((t,e)=>{"use strict";ee();var r=IR(),n=lu(),i=hS(),a=OR(),{DatabaseError:s}=pS(),o=x(u=>{var l;return l=class extends a{constructor(p){super(p,u)}},x(l,"BoundPool"),l},"poolFactory"),c=x(function(u){this.defaults=n,this.Client=u,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=uu(),this.DatabaseError=s},"PG");typeof fe.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(D_()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var u=null;try{u=new c(D_())}catch(l){if(l.code!=="MODULE_NOT_FOUND")throw l}return Object.defineProperty(e.exports,"native",{value:u}),u}}))});ee();var vS=ua(mh());hh();ee();hh();oS();var qR=ua(pu()),BR=ua(ph());function yS(t){return t instanceof oe?"\\x"+t.toString("hex"):t}x(yS,"encodeBuffersAsBytea");var bS=class xS extends Error{constructor(e){super(e),ce(this,"name","NeonDbError"),ce(this,"severity"),ce(this,"code"),ce(this,"detail"),ce(this,"hint"),ce(this,"position"),ce(this,"internalPosition"),ce(this,"internalQuery"),ce(this,"where"),ce(this,"schema"),ce(this,"table"),ce(this,"column"),ce(this,"dataType"),ce(this,"constraint"),ce(this,"file"),ce(this,"line"),ce(this,"routine"),ce(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,xS)}};x(bS,"NeonDbError");var oa=bS,F_="transaction() expects an array of queries, or a function returning an array of queries",MR=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function wS(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:a,deferrable:s,queryCallback:o,resultCallback:c,authToken:u}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let l;try{l=fh(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:h,hostname:g,port:m,pathname:f}=l;if(p!=="postgres:"&&p!=="postgresql:"||!h||!g||!f)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function y(E,..._){let P,R;if(typeof E=="string")P=E,R=_[1],_=_[0]??[];else{P="";for(let k=0;k<E.length;k++)P+=E[k],k<_.length&&(P+="$"+(k+1))}_=_.map(k=>yS((0,qR.prepareValue)(k)));let S={query:P,params:_};return o&&o(S),_S(w,S,R)}x(y,"resolve"),y.transaction=async(E,_)=>{if(typeof E=="function"&&(E=E(y)),!Array.isArray(E))throw new Error(F_);E.forEach(S=>{if(S[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(F_)});let P=E.map(S=>S.parameterizedQuery),R=E.map(S=>S.opts??{});return w(P,R,_)};async function w(E,_,P){let{fetchEndpoint:R,fetchFunction:S}=sn,k=Array.isArray(E)?{queries:E}:E,T=n??{},C=e??!1,q=r??!1,B=i,V=a,$=s;P!==void 0&&(P.fetchOptions!==void 0&&(T={...T,...P.fetchOptions}),P.arrayMode!==void 0&&(C=P.arrayMode),P.fullResults!==void 0&&(q=P.fullResults),P.isolationLevel!==void 0&&(B=P.isolationLevel),P.readOnly!==void 0&&(V=P.readOnly),P.deferrable!==void 0&&($=P.deferrable)),_!==void 0&&!Array.isArray(_)&&_.fetchOptions!==void 0&&(T={...T,..._.fetchOptions});let L=u;!Array.isArray(_)&&_?.authToken!==void 0&&(L=_.authToken);let F=typeof R=="function"?R(g,m,{jwtAuth:L!==void 0}):R,W={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},Q=await SS(L);Q&&(W.Authorization=`Bearer ${Q}`),Array.isArray(E)&&(B!==void 0&&(W["Neon-Batch-Isolation-Level"]=B),V!==void 0&&(W["Neon-Batch-Read-Only"]=String(V)),$!==void 0&&(W["Neon-Batch-Deferrable"]=String($)));let te;try{te=await(S??fetch)(F,{method:"POST",body:JSON.stringify(k),headers:W,...T})}catch(he){let ae=new oa(`Error connecting to database: ${he.message}`);throw ae.sourceError=he,ae}if(te.ok){let he=await te.json();if(Array.isArray(E)){let ae=he.results;if(!Array.isArray(ae))throw new oa("Neon internal error: unexpected result format");return ae.map((xe,$e)=>{let mn=_[$e]??{},Ea=mn.arrayMode??C,Ca=mn.fullResults??q;return ah(xe,{arrayMode:Ea,fullResults:Ca,parameterizedQuery:E[$e],resultCallback:c,types:mn.types})})}else{let ae=_??{},xe=ae.arrayMode??C,$e=ae.fullResults??q;return ah(he,{arrayMode:xe,fullResults:$e,parameterizedQuery:E,resultCallback:c,types:ae.types})}}else{let{status:he}=te;if(he===400){let ae=await te.json(),xe=new oa(ae.message);for(let $e of MR)xe[$e]=ae[$e]??void 0;throw xe}else{let ae=await te.text();throw new oa(`Server error (HTTP status ${he}): ${ae}`)}}}return x(w,"execute"),y}x(wS,"neon");function _S(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:x((n,i)=>t(e,r).then(n,i),"then"),catch:x(n=>t(e,r).catch(n),"catch"),finally:x(n=>t(e,r).finally(n),"finally")}}x(_S,"createNeonQueryPromise");function ah(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:a}){let s=new BR.default(a),o=t.fields.map(l=>l.name),c=t.fields.map(l=>s.getTypeParser(l.dataTypeID)),u=e===!0?t.rows.map(l=>l.map((p,h)=>p===null?null:c[h](p))):t.rows.map(l=>Object.fromEntries(l.map((p,h)=>[o[h],p===null?null:c[h](p)])));return i&&i(n,t,u,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=u,t._parsers=c,t._types=s,t):u}x(ah,"processQueryResult");async function SS(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new oa("Error getting auth token.");throw e instanceof Error&&(r=new oa(`Error getting auth token: ${e.message}`)),r}}x(SS,"getAuthToken");var DR=ua(dh()),la=ua(mh()),ES=class extends vS.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=this.connec